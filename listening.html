
<div style="font-family: Arial; font-size: 20.8px; max-width: 780px; margin: auto; padding: 20px;">

  <style>
    body {
        font-family: Arial, sans-serif;
        max-width: 780px;
        margin: auto;
        padding: 20px;
    }
    .report-content {
      font-family: 'Georgia', serif;
      font-size: 16px;
    }
    #taskType {
      font-family: 'Verdana', sans-serif;
      font-size: 15px;
    }
    select option { white-space: normal; }
    textarea, select, button {
        font-size: 20.8px;
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
        border: 10px solid #f2f5a9;
        border-radius: 4px;
        margin-top: 5px;
    }
    button {
        width: auto;
        cursor: pointer;
        padding: 10px 20px;
        background-color: #007BFF;
        color: white;
        border: none;
        border-radius: 4px;
    }
    button:hover {
        background-color: #0056b3;
    }
    label {
        font-weight: bold;
        display: block;
        margin-top: 15px;
    }
  </style>

  <!-- Date (display-only, te reo with macrons first, then English) -->
  <div>
    <label for="report-date" style="font-weight: bold;">RÄ â€“ Date:</label><br>
    <div id="report-date" style="font-size: 20.8px; padding: 4px 0;"></div>
  </div><br>

  <h3>PÅ«rongo Whakarongo â€“ Listening Report Generator</h3>

  <label for="class">Akomanga â€“ Class:</label><br>
  <select id="class" onchange="setMarkingOptions()">
    <option value="">Select Class</option>
    <option value="7b">7b</option>
    <option value="7g">7g</option>
    <option value="9-1">9-1</option>
    <option value="9-4">9-4</option>
    <option value="10-3">10-3</option>
    <option value="10-6">10-6</option>
  </select><br><br>

  <label for="group">RÅpÅ« â€“ Group:</label><br>
  <textarea id="group" rows="2"></textarea><br><br>

  <div style="font-size: 18px; margin-bottom: 6px;">
    <strong>âœï¸ Tuhia ngÄ kÅrero i rangona ai â€“ Write what you hear</strong><br>
    Write as much as you can of what you hear â€“ in any language. This is your listening and writing assessment, so the more you write in te reo, the better.
  </div>

  <!-- Task Type Dropdown -->
  <div class="task-type-section" style="margin-top: 1em;">
    <label for="taskType" style="font-weight: bold;">Task Type:</label>
    <select id="taskType" name="taskType" style="margin-left: 0.5em; font-size: 20.8px;">
      <option value="Dialogue Task" selected>Dialogue Task</option>
      <option value="E hia Tokohia">E hia Tokohia</option>
      <option value="MÄui">MÄui</option>
      <option value="Pepeha">Pepeha</option>
      <option value="PÄngarau">PÄngarau</option>
      <option value="Tamariki">Tamariki</option>
      <option value="Tunu Kai">Tunu Kai</option>
      <option value="Te WÄ">Te WÄ</option>
    </select>
  </div><br>

  <label for="listening">Whakarongo â€“ Listening:</label><br>
  <textarea id="listening" rows="4" placeholder="Write in english or Te Reo MÄori anything you can hear and understand from your peers' conversation. Anything you write is evidence of listening."></textarea><br><br>

  <label for="pronunciation">Tuku Reo â€“ Pronunciation Grade:</label><br>
  <select id="pronunciation">
    <option value="">--- Select Grade ---</option>
  </select><br><br>

  <label for="fluency">Rere o te KÅrero â€“ Fluency Grade:</label><br>
  <select id="fluency">
    <option value="">--- Select Grade ---</option>
  </select><br><br>

  <label for="feedback">Urupare â€“ Feedback:</label><br>
  <div style="font-size: 18px; margin-bottom: 4px;">
    <strong>ğŸŒ¿ KÅrero TÄ«matanga â€“ Sentence Starters:</strong><br>
    <em>He pai ki ahau te Ähua i ...</em> â€“ I really liked the way you...<br>
    <em>Ki Åku whakaaro, i whakaritea pai koe.</em> â€“ I can see you prepared well.<br>
    <em>Ko tÄ“tahi mea hei whakapai ake ...</em> â€“ One thing to improve is...<br>
    <em>I rangona ngÄ kupu i te tika o te whakahua</em> â€“ Your pronunciation of words was clear.
  </div>
  <textarea id="feedback" rows="10"></textarea><br><br>

  <button onclick="generateReport()">Generate Report</button>
  <button onclick="copyReport()" style="margin-left: 10px;">ğŸ“‹ Copy Report</button><br><br>

  <label for="report">PÅ«rongo â€“ Report (copy below):</label><br>
  <textarea id="report" class="report-content" rows="12"></textarea>

</div>

<script>
  // Formatters: MÄori (with macrons) and English
  function formatDateMÄori(dateObj) {
    const months = [
      "Kohi-tÄtea", "Hui-tanguru", "PoutÅ«-te-rangi", "Paenga-whÄwhÄ",
      "Haratua", "Pipiri", "HÅngongoi", "Here-turi-kÅkÄ",
      "Mahuru", "Whiringa-Ä-nuku", "Whiringa-Ä-rangi", "Hakihea"
    ];
    const day = dateObj.getDate();
    const month = months[dateObj.getMonth()];
    const year = dateObj.getFullYear();
    return `${day} o ${month} ${year}`;
  }

  function formatDateEnglish(dateObj) {
    const day = dateObj.getDate();
    const month = dateObj.toLocaleString('en-NZ', { month: 'long' });
    const year = dateObj.getFullYear();
    return `${day} ${month} ${year}`;
  }

  // Populate the date (display-only) on load
  document.addEventListener("DOMContentLoaded", () => {
    const today = new Date();
    const formattedMÄori = formatDateMÄori(today);
    const formattedEnglish = formatDateEnglish(today);
    document.getElementById("report-date").textContent = `${formattedMÄori} (${formattedEnglish})`;

    // ensure pron/fluency placeholders are present initially
    const pronunciation = document.getElementById("pronunciation");
    const fluency = document.getElementById("fluency");
    pronunciation.innerHTML = '<option value="">--- Select Grade ---</option>';
    fluency.innerHTML = '<option value="">--- Select Grade ---</option>';
  });

  // Class-based grading options (restored full logic & bilingual entries)
  function setMarkingOptions() {
    const classVal = document.getElementById("class").value;
    const pronunciation = document.getElementById("pronunciation");
    const fluency = document.getElementById("fluency");

    pronunciation.innerHTML = '<option value="">--- Select Grade ---</option>';
    fluency.innerHTML = '<option value="">--- Select Grade ---</option>';

    const gradeSets = {
      "7": {
        pron: [
          ["ğŸ”´ KÄore anÅ kia tutuki", "Me whakapai ake te tuku reo"],
          ["ğŸ”´ Not Yet Achieved", "Pronunciation needs further development"],
          ["ğŸŸ  Kua tutuki", "He mÄmÄ te mÄrama, ahakoa he hapa i Ä“tahi wÄ"],
          ["ğŸŸ  Achieved", "Basic pronunciation is understandable with some errors"],
          ["ğŸ”µ Paetae", "He pai te whakaputa kupu, Ä, ka kitea te kaha ki te whakamahi tika i ngÄ oro"],
          ["ğŸ”µ Merit", "Mostly clear pronunciation with good effort to use correct sounds"],
          ["ğŸŸ¢ Hiranga", "He mÄrama, he mÄia te tuku reo, Ä, he tika ngÄ oro pÅ« me ngÄ oro Ä-kupu"],
          ["ğŸŸ¢ Excellence", "Clear and confident pronunciation with accurate vowel and consonant sounds"]
        ],
        flu: [
          ["ğŸ”´ KÄore anÅ kia tutuki", "Me whakapai ake te rere o te kÅrero"],
          ["ğŸ”´ Not Yet Achieved", "Fluency needs further development"],
          ["ğŸŸ  Kua tutuki", "He pÅturi, he Äwangawanga te kÅrero, engari ka whai i te aronga tika"],
          ["ğŸŸ  Achieved", "Speech is slow or hesitant but mostly follows a logical flow"],
          ["ğŸ”µ Paetae", "He pai te rere o te kÅrero, kÄore he maha o ngÄ whakatikatika"],
          ["ğŸ”µ Merit", "Speech flows well with few pauses or corrections"],
          ["ğŸŸ¢ Hiranga", "He maeneene, he taiao, he whakapuaki pai te kÅrero, me te pai o te tere me te rangi"],
          ["ğŸŸ¢ Excellence", "Speech is smooth, natural, and expressive with strong rhythm and pace"]
        ]
      },
      "9": {
        pron: [
          ["ğŸ”´ KÄore anÅ kia tutuki", "He maha ngÄ hapa, me whakapai ake"],
          ["ğŸ”´ Not Yet Achieved", "Pronunciation needs further development"],
          ["ğŸŸ  Kua tutuki", "He tika te nuinga o te tuku reo, ahakoa he hapa i Ä“tahi wÄ"],
          ["ğŸŸ  Achieved", "Pronunciation is mostly correct with occasional errors"],
          ["ğŸ”µ Paetae", "He mÄrama, he auau te tuku reo, Ä, he pai te whakahua i ngÄ oro MÄori"],
          ["ğŸ”µ Merit", "Clear and consistent pronunciation with good articulation of MÄori sounds"],
          ["ğŸŸ¢ Hiranga", "He tino pai te tuku reo, Ä, ka whakamahia ngÄ tohutÅ me te pÄ“hanga tika"],
          ["ğŸŸ¢ Excellence", "Excellent pronunciation with confident use of macrons and correct stress"]
        ],
        flu: [
          ["ğŸ”´ KÄore anÅ kia tutuki", "He Äwangawanga te rere o te kÅrero"],
          ["ğŸ”´ Not Yet Achieved", "Fluency needs further development"],
          ["ğŸŸ  Kua tutuki", "He rere pai te nuinga, ahakoa he Äwangawanga i Ä“tahi wÄ"],
          ["ğŸŸ  Achieved", "Speech is mostly fluent with some hesitation"],
          ["ğŸ”µ Paetae", "He pai te rere, Ä, he pai te tere me te whakapuaki"],
          ["ğŸ”µ Merit", "Speech flows well with good pacing and expression"],
          ["ğŸŸ¢ Hiranga", "He rere taiao, he whakapuaki pai, me te rangi tika"],
          ["ğŸŸ¢ Excellence", "Fluent, expressive delivery with natural intonation and rhythm"]
        ]
      },
      "10": {
        pron: [
          ["ğŸ”´ KÄore anÅ kia tutuki", "He hapa nui tonu, me whakapai ake"],
          ["ğŸ”´ Not Yet Achieved", "Pronunciation needs further development"],
          ["ğŸŸ  Kua tutuki", "He tika te nuinga o te tuku reo, he hapa iti"],
          ["ğŸŸ  Achieved", "Pronunciation is generally correct with minor errors"],
          ["ğŸ”µ Paetae", "He mÄrama, he mÄia te tuku reo, Ä, ka kitea te aro ki ngÄ taipitopito"],
          ["ğŸ”µ Merit", "Clear, confident pronunciation with attention to detail"],
          ["ğŸŸ¢ Hiranga", "He tino tika te tuku reo, Ä, he tino pai te whakahaere i ngÄ oro MÄori me te pÄ“hanga"],
          ["ğŸŸ¢ Excellence", "Highly accurate pronunciation with excellent control of MÄori phonetics and emphasis"]
        ],
        flu: [
          ["ğŸ”´ KÄore anÅ kia tutuki", "He Äwangawanga, he whakatikatika i te kÅrero"],
          ["ğŸ”´ Not Yet Achieved", "Fluency needs further development"],
          ["ğŸŸ  Kua tutuki", "He rere pai, ahakoa he whakatikatika i Ä“tahi wÄ"],
          ["ğŸŸ  Achieved", "Speech is coherent with some pauses or self-correction"],
          ["ğŸ”µ Paetae", "He rere pai, he whakapuaki pai, me te rangi tika"],
          ["ğŸ”µ Merit", "Fluent and expressive delivery with good rhythm and tone"],
          ["ğŸŸ¢ Hiranga", "He rere maeneene, he mÄia, he whakapuaki pai me te mÄrama"],
          ["ğŸŸ¢ Excellence", "Seamless, confident, and engaging delivery with excellent flow and clarity"]
        ]
      }
    };

    // derive year group from class string (7*, 9*, 10*)
    const year =
      classVal.startsWith("7") ? "7" :
      classVal.startsWith("9") ? "9" :
      classVal.startsWith("10") ? "10" : null;

    if (!year) return;

    // Populate pronunciation options (keep bilingual entries)
    gradeSets[year].pron.forEach(([label, desc]) => {
      const option = document.createElement("option");
      option.value = `${label}: ${desc}`;
      option.text = `${label}: ${desc}`;
      option.style.color = label.includes("ğŸ”´") ? "#b30000" :
                           label.includes("ğŸŸ ") ? "#cc6600" :
                           label.includes("ğŸ”µ") ? "#0066cc" :
                           label.includes("ğŸŸ¢") ? "#228B22" : "#000000";
      pronunciation.appendChild(option);
    });

    // Populate fluency options
    gradeSets[year].flu.forEach(([label, desc]) => {
      const option = document.createElement("option");
      option.value = `${label}: ${desc}`;
      option.text = `${label}: ${desc}`;
      option.style.color = label.includes("ğŸ”´") ? "#b30000" :
                           label.includes("ğŸŸ ") ? "#cc6600" :
                           label.includes("ğŸ”µ") ? "#0066cc" :
                           label.includes("ğŸŸ¢") ? "#228B22" : "#000000";
      fluency.appendChild(option);
    });
  }

  // Build the report text â€” includes the single display date (both languages)
  function generateReport() {
    const formattedDate = document.getElementById("report-date").textContent || "";

    const classVal = document.getElementById("class").value;
    const group = document.getElementById("group").value;
    const taskType = document.getElementById("taskType").value;
    const listening = document.getElementById("listening").value;
    const pronunciation = document.getElementById("pronunciation").value;
    const fluency = document.getElementById("fluency").value;
    const feedback = document.getElementById("feedback").value;

    const report = `My Assessment - Listening ğŸ“… RÄ: ${formattedDate}

Akomanga: ${classVal}  RÅpÅ«: ${group}  Task Type: ${taskType}

ğŸ§ Whakarongo:
${listening}

âœ… Tuku Reo â€“ Pronunciation Grade:
${pronunciation}

âœ… Rere o te KÅrero â€“ Fluency Grade:
${fluency}

ğŸ“ Urupare â€“ Feedback:
${feedback}`;

    document.getElementById("report").value = report;
  }

  // Copy report with modern clipboard API fallback
  function copyReport() {
    const reportText = document.getElementById("report").value || "";
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(reportText)
        .then(() => alert("Report copied to clipboard!"))
        .catch(() => fallbackCopy());
    } else {
      fallbackCopy();
    }

    function fallbackCopy() {
      const textarea = document.getElementById("report");
      textarea.select();
      textarea.setSelectionRange(0, 99999);
      try {
        document.execCommand("copy");
        alert("Report copied to clipboard!");
      } catch (e) {
        alert("Unable to copy automatically â€” please select and copy the report manually.");
      }
    }
  }
</script>
